# Домашнее задание к занятию 12.8 "Резервное копирование баз данных"

Домашнее задание выполните в Google Docs и отправьте в личном кабинете на проверку ссылку на ваш документ.

Название файла должно содержать номер лекции и фамилию студента. Пример названия: "12.8 Резервное копирование баз данных - Александр Волянский"

Перед тем как выслать ссылку, убедитесь, что ее содержимое не является приватным (открыто на просмотр всем, у кого есть ссылка). Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надежность работы БД и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1 Необходимо восстанавливать данные в полном объеме за предыдущий день.

1.2 Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую/починеную БД?

*Приведите ответ в свободной форме.*

1.1 Предположим что мы каждый день "ночью" делаем бекап full, собственно отсюда выливается что мы восстановим предыдущий день. (случай если делаем бекапы FULL да да, иногда я таким грешу)
Второй вариант если мы в начале недели делаем FULL бекап и каждый день вечером делаем Incremental бекап, собственно Incremental на нужный предыдущий день восстанавливаем копию.

1.2 Схема тут FULL бекап в начале недели и делаем Incremental бекап по промежутку времени ( хоть каждые 30 минут), главное иметь место на носителях куда делаются бекапы.

1.3 Настроить репликацию мастер-слейв (синхронную репликацию), после сбоя мастера назначит слейва как мастер и можно работать.

---

### Задание 2. PostgreSQL

2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

2.1 из официально документации
```
pg_dump [параметр-подключения...] [параметр...] [имя_бд]

$ pg_dump mydb > db.sql

pg_restore [параметр-подключения...] [параметр...] [имя_файла]

$ pg_restore -d newdb db.dump

```
2.1 да возможно написать скрипт и запускать его через планировщике crontab



---

### Задание 3. MySql

3.1 С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySql. 

3.1* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

*3.1*
Исползование команды *--incremental-base=mode:argument*

и пример использования:

```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```
взял информацию отсюда https://dev.mysql.com/doc/mysql-enterprise-backup/4.1/en/mysqlbackup.incremental.html

*3.1* 
Использование реплики будет давать преимущество в быстром восстановлении к базе клиентов. Если у нас очень большая база восстанавливать мы ее будет не меньше чем  20-30 минут, а с репликой мы можем слейва сделать мастером и направить клиентов на новый мастер.

---

Задания,помеченные звездочкой * - дополнительные (не обязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. Вы можете их выполнить, если хотите глубже и/или шире разобраться в материале.